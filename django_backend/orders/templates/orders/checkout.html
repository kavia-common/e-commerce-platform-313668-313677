{% extends "base.html" %}
{% load cart_extras %}
{% block title %}Checkout{% endblock %}
{% block content %}
<h1 class="h4 mb-3">Checkout</h1>

{% if not items %}
  <div class="alert alert-info">Your cart is empty.</div>
{% else %}
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h6 mb-3">Delivery Details</h2>
          <form method="post" novalidate>
            {% csrf_token %}
            {{ form.non_field_errors }}
            <div class="mb-3">
              <label class="form-label" for="{{ form.address.id_for_label }}">Address</label>
              {{ form.address }}
              {% for err in form.address.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" for="{{ form.city.id_for_label }}">City</label>
                {{ form.city }}
                {% for err in form.city.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
              </div>
              <div class="col-md-6">
                <label class="form-label" for="{{ form.state.id_for_label }}">State</label>
                {{ form.state }}
                {% for err in form.state.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-6">
                <label class="form-label" for="{{ form.zipcode.id_for_label }}">Zipcode</label>
                {{ form.zipcode }}
                {% for err in form.zipcode.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
              </div>
              <div class="col-md-6">
                <label class="form-label" for="{{ form.contact_number.id_for_label }}">Contact Number</label>
                {{ form.contact_number }}
                {% for err in form.contact_number.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
              </div>
            </div>
            <div class="mt-3 mb-3">
              <label class="form-label" for="{{ form.payment_mode.id_for_label }}">Payment Mode</label>
              {{ form.payment_mode }}
              {% for err in form.payment_mode.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
            </div>
            <button class="btn btn-primary" type="submit">Place Order</button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h6 mb-3">Order Summary</h2>
          <ul class="list-group mb-3">
            {% for i in items %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-semibold">{{ i.product.name }}</div>
                  <div class="small text-muted">Qty: {{ i.quantity }}</div>
                </div>
                <div class="fw-semibold">${{ i.product.price|mul:i.quantity }}</div>
              </li>
            {% endfor %}
          </ul>
          <div class="d-flex justify-content-between">
            <div class="fw-semibold">Total</div>
            <div class="fw-semibold">${{ total }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endif %}
{% endblock %}
